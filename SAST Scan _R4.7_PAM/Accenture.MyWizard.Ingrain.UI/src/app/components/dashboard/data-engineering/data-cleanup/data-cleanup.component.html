<!-- Add Feature button -->
<div class="d-flex justify-content-end align-items-end" align="right" style="padding-right: 4.7%;">
  <input *ngIf="!readOnly" type="button" class="btn btn-secondary" value="Add Feature"
    (click)="openAddFeatureTypeSelection(addFeatureManualModal)"
    [disabled]="(isDirty == 'Yes') || isLoading || modelType == 'TimeSeries' || modelType == 'timeseries'">
  <input *ngIf="readOnly" (click)="accessDenied()" type="button" class="btn btn-secondary btn-sm" value="Add Feature"
    disabled>
</div>
<!-- Add Feature button -->

<fieldset [disabled]="readOnly">
  <div class="ingrain-flyout-container prescription" *ngIf='!isLoading' [ngClass]="status ?'': 'open'">
    <div class="ingrain-flyout">
      <div class="ingrain-flyout-content myw-scrollbar" style=" max-height: 22rem;">
        <div class="fs-12 mb-2" *ngIf=' !( fixDataQuality.size > 0 || fixMissingValue.size > 0 ) && 
          !( unselectedDatatypeFeatures.size > 0 || fixEmptyDatatypeFeatureNames.size > 0 || isEmptyObject(correlationtoRemove))
          '>No Recommended Actions. Please click Next to proceed</div>

        <div class="fs-12 myw-500 mb-2" *ngIf=' fixDataQuality.size > 0 || fixMissingValue.size > 0'>Auto Data Curation
        </div>
        <div *ngIf="dataCleanUpData" class="ingrAI-list-item-container ingerAI-predescription-list-item-container">

          <ol class="ingrAI-list-item">
            <!-- <li *ngIf='idDataTypeForPrescription.size > 0'> {{attributesWithId}} identified as Unique ID and hence will be excluded from Data Quality score and model training </li> -->
            <li *ngIf='fixDataQuality.size > 0'> Attributes with < 30% data quality score will be excluded from model
                training </li>
            <li *ngIf='fixMissingValue.size > 0'> Attributes with > 50% missing values will be excluded from model
              training </li>
          </ol>
          <!-- <li >Attribute name is identified as Unique ID and hence will be excluded from Data Quality score and model training </li>
                <li  *ngIf='fixDataQuality.size > 0'>Attributes with < 30% data quality score will be excluded from model training  </li>
                <li *ngIf='fixMissingValue.size > 0'> Attributes with > 50% missing values will be excluded from model training </li> -->
          <!-- <div class="d-flex align-items-center mb-3">
                  <div class="ml-3">
                      <div *ngFor="let dataTypeIdMatchedFeature of idDataTypeForPrescription">{{dataTypeIdMatchedFeature}}
                        <input #selectedLabelForDatatypeId (change)="onChecked(selectedLabelForDatatypeId)"
                          [value]='dataTypeIdMatchedFeature' type="checkbox">
                      </div>
                  </div>
                  <button class="btn btn-sm btn-primary ml-auto">Take Action</button> -->
          <!-- </div> -->


          <!-- <div class="ingrAI-list-item" *ngIf='fixDataQuality.size > 0'>
                <span> Attributes with < 30% data quality score will be excluded from model training </span>
                <label class="myw-checkbox" *ngFor="let dataQualityFeature of fixDataQuality">
                  <span>{{dataQualityFeature}}</span>
                  <input #selectedLabel (change)="onChecked(selectedLabel)" [value]='dataQualityFeature' type="checkbox">
                </label>
              </div>
      
              <div class="ingrAI-list-item" *ngIf='fixMissingValue.size > 0'>
                <span> Attributes with > 50% missing values will be excluded from model training </span>
                <label class="myw-checkbox" *ngFor="let missingValues of fixMissingValue">
                  <span>{{missingValues}}</span>
                  <input #slectedLabelForMissingValues (click)="onChecked(slectedLabelForMissingValues)"
                    [value]='missingValues' type="checkbox">
                </label>
              </div> -->

          <!-- Parent name with checkbox-->
          <div class="fs-12 myw-500 mb-2"
            *ngIf='unselectedDatatypeFeatures.size > 0 || fixEmptyDatatypeFeatureNames.size > 0 || isEmptyObject(correlationtoRemove)'>
            Recommended Action</div>

          <ol *ngIf='unselectedDatatypeFeatures.size > 0 || isEmptyObject(correlationtoRemove) || !prescritiveFlag'>
            <li *ngIf='unselectedDatatypeFeatures.size > 0'>Select the appropriate option for the unidentified data type
              from the dropdown for</li>
            <div class="d-flex align-items-center mb-3" *ngIf='unselectedDatatypeFeatures.size > 0'>
              <div class="ml-3">
                <div *ngFor="let fixcolumn of unselectedDatatypeFeatures; let fixcolumnIndex = index">{{ fixcolumnIndex
                  +
                  1}} . {{fixcolumn}} </div>

              </div>
              <button class="btn btn-sm btn-primary ml-auto mt-auto" (click)="prescriptionOpen($event)">Take
                Action</button>
            </div>
            <li *ngIf="isEmptyObject(correlationtoRemove)">Suggest to retain only required attribute from the highly
              correlated attributes listed below</li>
            <div class="d-flex align-items-center" *ngIf="isEmptyObject(correlationtoRemove)">
              <div class="ml-4">
                <div *ngFor="let correlatedKeys of highlyCorrelatedKeys">
                  <label class="myw-checkbox" *ngIf="prescriptionCorrelatedVal[correlatedKeys].length > 0">
                    <input #slectedLabelForCorrelated1 (click)="onChecked(slectedLabelForCorrelated1)"
                      [value]='correlatedKeys' type="checkbox">
                    <span>{{correlatedKeys}}</span>
                  </label>
                  <ng-container *ngIf="prescriptionCorrelatedVal[correlatedKeys].length > 0">
                    <div *ngFor="let values of prescriptionCorrelatedVal[correlatedKeys]">
                      <label class="myw-checkbox ml-3">
                        <input #slectedLabelForCorrelated
                          (click)="onChecked(slectedLabelForCorrelated, prescriptionCorrelatedVal[correlatedKeys].length )"
                          [value]='values' type="checkbox">
                        <span>{{values}}</span>
                      </label>
                    </div>
                  </ng-container>
                </div>
              </div>
              <button class="btn btn-sm btn-secondary ml-auto mt-auto" (click)='fixit()' type="button"
                [disabled]="tempFeaturesNamestobeFixed.length>0? null:true">Auto Fix</button>
            </div>
          </ol>

        </div>
        <!-- <div *ngIf='fixEmptyDatatypeFeatureNames.size > 0 || highlyCorrelatedKeys.length>0 || fixMissingValue.size > 0 || fixDataQuality.size > 0 || idDataTypeForPrescription.size > 0'
              class="d-flex justify-content-end py-2 ml-auto">
              <input (click)='fixit()' type="button" [attr.disabled]="tempFeaturesNamestobeFixed.length>0?null:''"
                class="btn btn-sm btn-secondary" value="Auto fix" />
              <input type="button" [disabled]='fixitBtnDisabled' (click)="prescriptionOpen($event)" class="btn btn-sm btn-secondary"
                value="Ignore" />
            </div> -->
      </div>
      <div class="ingrain-fly-header" (click)="prescriptionOpen($event)">
        <div class="ingrain-flytext">Prescription</div>
      </div>

    </div>
  </div>

  <div class="myw-container my-3 position-relative h-100">
    <table class="table table-striped table-hover table-vmiddle myw-table">
      <thead>
        <tr>
          <th class="data-curation-heading" scope="col" id="truncate-data">Attribute Name
            <div class="data-curation-tooltip" style="overflow: auto; height: 124%;">Indicates the name of the
              attributes
              provided in the dataset</div>
          </th>
          <th class="data-curation-heading text-center column-datatype" scope="col">Data Type
            <div class="data-curation-tooltip" style="overflow: auto; height: 168%;">Indicates the data type of the
              attribute (categorical/integer/text/float/datetime)</div>
          </th>
          <!-- <th></th> -->
          <th class="data-curation-heading" scope="col">Unique
            <div class="data-curation-tooltip" style="overflow: auto; height: 118%;">Indicates the (%) of unique values
              in
              the dataset for each attribute</div>
          </th>
          <th class="data-curation-heading text-center" scope="col">Correlation
            <div class="data-curation-tooltip" style="overflow: auto; height: 117%;">Indicates whether attributes are
              related to each other. If they are related to each other it means that they bring out the same
              information,
              therefore, it is logical to retain only the required attribute</div>
          </th>
          <th class="data-curation-heading text-center column-scale" scope="col">Scale
            <div class="data-curation-tooltip" style="overflow: auto; height: 178%;">Nature of information provided by
              each attribute. It is applicable only for text/categorical data. Nominal: separates the data into groups
              identified by name. Ordinal: separates the data into groups identified by some type of order.
            </div>
          </th>
          <th class="data-curation-heading" scope="col">Missing values
            <div class="data-curation-tooltip" style="overflow: auto; height: 118%;">Indicates the (%) of missing values
              in the dataset for each attribute </div>
          </th>
          <th class="data-curation-heading" scope="col">Outlier
            <div class="data-curation-tooltip" style="overflow: auto; height: 143%;">Indicates the (%) of an
              outliers/odd
              value in the dataset for each attribute</div>
          </th>
          <th class="data-curation-heading" scope="col">Balanced
            <div class="data-curation-tooltip" style="overflow: auto; height: 178%;">Refers to a situation where the
              number of observations is the same for all the classes in a categorical dataset </div>
          </th>
          <th class="data-curation-heading" scope="col">Skewness
            <div class="data-curation-tooltip" style="overflow: auto; height: 178%;">Refers to a situation where there
              is
              an imbalance or an asymmetry from the mean of a numerical data distribution, based on which majority of
              the
              data can be left/right skewed</div>
          </th>
          <th class="data-curation-heading" scope="col">Data Quality
            <div class="data-curation-tooltip" style="overflow: auto; height: 178%;">Data quality scores are computed
              based on quality dimensions for each individual attribute in the data set, and then a combined quality
              score
              is calculated
              <p>100 - Missing – Imbalanced-skewness-outlier = Data Quality</p>
            </div>
          </th>
        </tr>
      </thead>

      <ng-container *ngIf="isLoading; then displayLoader else displayTableData"></ng-container>
      <ng-template #displayLoader>
        <tbody>
          <app-loader-display></app-loader-display>
          <div *ngIf="pythonProgressStatus == 'P'" class="IngrAI-python-progress-dialogbox">
            <p>Data process in progress</p>
            <p> {{pythonProgress}}% Completed </p>
          </div>
        </tbody>
      </ng-template>
      <ng-template #displayTableData>
        <tbody>
          <tr *ngFor="let featureName of featureNames | search:searchText |  paginate: { id: 'showData_pagination',
              itemsPerPage: itemsPerPage,
              currentPage: page
             } ; let i = index">
            <td style="max-width: 2em;">{{featureName}}</td>
            <td>
              <select #selectedDataType [ngClass]="getUnselectedDatatype(featureName)? 'emptyDatatypes': ''"
                class="form-control" [id]="'select' + i" style="width: 8rem;"
                (change)="selectedDatatypeOption(featureName,selectedDataType.value, $event)" [disabled]="(featureNamesObject[featureName].hasOwnProperty('AddFeature') && 
                    featureNamesObject[featureName]['AddFeature'] === 'True') ||
                    ( IsModelTrained && featureName == targetColumn ) ||
                    ( Existing_Features_Disabled && Existing_Features_Disabled.has(featureName)) || 
                     disabledDateTimeForTimeSeriesModel[featureName] ">
                <option *ngFor="let dataType of getDataTypes(featureName)"
                  [selected]='getDefaultSeletedDataType(featureName,dataType)' [value]="dataType">
                  {{dataType}}
                </option>
              </select>
            </td>
            <!-- <td style="width: 11%;">
                  <div class="form-group">
                  <select #selectedDataTypeFormat *ngIf = "selectedDataType.value === 'datetime64[ns]' || selectedDataType.value === 'datetime'"
                   class="form-control" (change)="selectedDateFormat(featureName,selectedDataType.value,selectedDataTypeFormat.value)">
                  <option *ngFor="let format of DateFormat" [selected]='getSelectedDateFormat(featureName, format)'
                  [value]="format">
                    {{format}}
                  </option>
                  </select>
                  </div>
                </td> -->
            <td>{{getUniqueValue(featureName)}}</td>
            <td><span>{{getCorrelation(featureName)}}</span>
            </td>
            <td>
              <select #selectedScale class="form-control" style="width: 8rem;"
                (change)="selectedScaleOption(featureName,selectedScale.value)" [disabled]="(featureNamesObject[featureName].hasOwnProperty('AddFeature') && featureNamesObject[featureName]['AddFeature'] === 'True')
                  || ( Existing_Features_Disabled && Existing_Features_Disabled.has(featureName))">
                <option *ngFor="let scale of getScales(featureName)"
                  [selected]='getDefaultSeletedScale(featureName,scale)' [value]='scale'>{{scale}}</option>
              </select>
            </td>
            <td>{{getMissingValue(featureName)}}</td>
            <td>{{getOutlier(featureName)}}</td>
            <td>{{getBalanced(featureName) }}</td>
            <td>{{ getSKewNess(featureName)}}</td>
            <td>
              <div class="d-flex myw-table-actions">
                <span [ngClass]="getClassForDataQualityScore(featureName)" class="ingrain-dq" style="width: auto;">
                  {{getDataQualityScore(featureName)}}</span>
                <div (mouseover)="openHelper(featureName)">
                  <app-info-tooltip [className]="'toggleRight'"
                    [dynamicDescription]="'Data Modification : '+dataQualityInfo">
                  </app-info-tooltip>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </ng-template>
    </table>
    <div class="d-flex align-items-center justify-content-end myw-pagination mb-0 mt-0">
      <nav>
        <ul class="pagination">
          <!-- <li class="page-item" [ngClass]="{'disabled' : page == 1 }"><a href="javascript:;" class="page-link" aria-label="First" tabindex="-1" (click)="page = 1"><span aria-hidden="true">&lt;&lt;</span></a></li> -->
          <li style="margin-top: 1em;">
            <pagination-controls id="showData_pagination" maxSize="8" directionLinks="true"
              (pageChange)="page = $event">
            </pagination-controls>
          </li>
          <!-- <li class="page-item" [ngClass]="{'disabled' : (featureNames.length / itemsPerPage === page || featureNames.length / itemsPerPage === page - 1  ) }"><a href="javascript:;" class="page-link" aria-label="Last"><span aria-hidden="true">&gt;&gt;</span></a></li> -->
        </ul>
      </nav>
      <!-- <label class="sr-only">>></label> -->
      <div class="position-relative">
        <label class="sr-only">Page Selection</label>
        <select #limit (change)="itemsPerPage = limit.value">
          <option value="10">10/Page</option>
          <option value="20">20/Page</option>
          <option value="30">30/Page</option>
        </select>
      </div>
    </div>
  </div>

</fieldset>

<ng-template #confirmChangesOnDataCuration>
  <div class="deploymodle-confirmpopup">
    <div class="modal-header" style="border-bottom: none;">
      <h5 class="modal-title" id="saveViewModalTitle">&nbsp;</h5>
      <button type="button" class="close pull-right" style="cursor: pointer;" aria-label="Close"
        (click)="modalRef.hide()">
        <svg class="ingrAI-icon-svg ingrAI-icon-svg-md">
          <use xlink:href="#ingrAI-icon-close"></use>
        </svg>
      </button>
    </div>
    <div class="modal-body">
      You have made some changes to the trained model. By saving these changes, the model will have to be retrained
      in the Recommended AI section. Click Yes if you wish to Proceed or No to Return.
      <div class="modal-footer" style="border-top: none;">
        <button type="button" class="btn btn-secondary" style=" font-size: 1rem;" (click)="decline()">No</button>
        <button type="button" class="btn btn-primary" style=" font-size: 1rem;" (click)="confirm()">Yes</button>
      </div>
    </div>
  </div>
</ng-template>


<ng-template #UnchangedDtypeColumns>
  <div class="deploymodle-confirmpopup">
    <div class="modal-header" style="border-bottom: none;">
      <button type="button" class="close pull-right" style="cursor: pointer;" aria-label="Close"
        (click)="modalRefDataQuality.hide()">
        <svg class="ingrAI-icon-svg ingrAI-icon-svg-md">
          <use xlink:href="#ingrAI-icon-close"></use>
        </svg>
      </button>
    </div>
    <div class="modal-body">
      {{message}}
      <div class="modal-footer" style="border-top: none;">
        <!-- <button type="button" class="btn btn-secondary" style=" font-size: 1rem;" (click)="decline()">No</button> -->
        <button type="button" class="btn btn-primary" style=" font-size: 1rem;" (click)="confirm()">Ok</button>
      </div>
    </div>
  </div>
</ng-template>

<!-- Add Feature Manual Modal-->
<ng-template #addFeatureManualModal>

  <div class="modal-md">
    <app-add-feature-board [columnList]='columnList' [targetColumn]='targetColumn'
      [IsCustomColumnSelected]='IsCustomColumnSelected' (featureCreated)="reloadDataCleanUp($event)"
      [featuresAddedbyUser]="featuresAddedbyUser" [featureDataTypes]="featureDataTypes"></app-add-feature-board>
  </div>

</ng-template>

<!-- Add Feature Manual Modal-->