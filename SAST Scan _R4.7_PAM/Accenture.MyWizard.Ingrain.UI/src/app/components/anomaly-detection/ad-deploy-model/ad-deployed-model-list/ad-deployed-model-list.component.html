<div class="myw-wrapper container-fluid" style="min-height: unset;">
    <div class="myw-wrap">
        <div id="main" class="myw-content d-flex flex-column flex-fill">
            <div class="myw-container py-2">
                <div class="row">
                    <div class="col"><span><h6>Deployed Models List</h6></span></div>
                    <div *ngIf='myModelSelected' class="d-flex flex-nowrap justify-content-end">
                        <div class="myw-navbar-search" *ngIf="toggle" (click)="toggle = !toggle">
                            <input type="text" class="form-control form-control-sm" [(ngModel)]="searchText"
                                (input)="searchModel($event.target.value)" maxlength="70" placeholder="Search..." />
                            <img src="assets/images/close.svg" alt="Close" (click)="toggle = !toggle; clearSearch()" />
                        </div>
                        <div *ngIf="!toggle" style="display:inline-flex; margin-right: 1em;">
                            <input type="text" class="form-control form-control-sm" maxlength="70"
                                [(ngModel)]="searchText" (input)="searchModel($event.target.value)"
                                placeholder="Search..." style="width: 11.5rem;" />
                            <img src="assets/images/close.svg" alt="Close" (click)="toggle = !toggle; clearSearch()" />
                        </div>
                    </div>

                </div>
                
                <ng-container *ngIf='myModelSelected'>
                    <div class="myw-section my-3">
                        <div class="table-responsive" [ngClass]="totalRec <=5 ? 'modeldetails-tbl' : ''">
                            <table class="table table-striped table-hover table-vmiddle myw-table">
                                <thead>
                                    <tr>
                                        <th scope="col">Model Name</th>
                                        <th scope="col">Published Date</th>
                                        <th scope="col">Final Model</th>
                                        <th scope="col">Accuracy</th>
                                        <th scope="col">Status</th>
                                        <th scope="col">Visualisation</th>
                                        <th scope="col">Category</th>
                                        <th scope="col">Delete</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let model of models | paginate: { id: 'listing_pagination2',
                                    itemsPerPage: itemsPerPage,
                                    currentPage: page
                                }; let i = index">
                                        <td>
                                            <div *ngIf="!model.IsCascadeModel" class="d-flex">
                                                <ng-container
                                                    *ngIf="model.IsFMModel === false || model.IsFMModel === null">
                                                    <a routerLink="/anomaly-detection/problemstatement/usecasedefinition"
                                                        (click)=setCorrelationIdinLocalStorage(model.CorrelationId,model.IsReadOnlyAccess)
                                                        (click)=setModelNameinLocalStorage(model.ModelName,model.ModelVersion)
                                                        [queryParams]="{ 'modelName': model.ModelName,'pageSource': 'true'}">
                                                        {{model.ModelName}}</a>
                                                </ng-container>
                                                <ng-container *ngIf="model.IsFMModel === true">
                                                    <ng-container
                                                        *ngIf="model.FmModelStaus !== null && model.FmModelStaus !== undefined">
                                                        <ng-container *ngIf="model.FmModelStaus.Status === 'C'">
                                                            <a routerLink="/anomaly-detection/problemstatement/usecasedefinition"
                                                                (click)=setCorrelationIdinLocalStorage(model.CorrelationId,model.IsReadOnlyAccess)
                                                                (click)=setModelNameinLocalStorage(model.ModelName,model.ModelVersion)
                                                                [queryParams]="{ 'modelName': model.ModelName,'pageSource': 'true'}">
                                                                {{model.ModelName}}</a>
                                                            <span *ngIf="model.Status != 'Deployed'" title="Completed"
                                                                class="fm-status success"></span>
                                                        </ng-container>
                                                        <ng-container
                                                            *ngIf="model.FmModelStaus.Status === 'P' || model.FmModelStaus.Status === 'E' || model.FmModelStaus.Status === 'null'">
                                                            <a href="javascript:;"
                                                                (click)="FMModelInProgressPopup(FMInProgressPopup, model.FmModelStaus.Status)">{{model.ModelName}}</a>
                                                            <span title="Error" class="fm-status error"
                                                                *ngIf="model.FmModelStaus.Status === 'E'"></span>
                                                            <span title="In Progress" class="fm-status inprogress"
                                                                *ngIf="model.FmModelStaus.Status === 'P' || model.FmModelStaus.Status === 'null'"></span>
                                                        </ng-container>
                                                    </ng-container>
                                                    <ng-container
                                                        *ngIf="model.FmModelStaus === null || model.FmModelStaus === undefined">
                                                        <a href="javascript:;"
                                                            (click)="FMModelInProgressPopup(FMInProgressPopup, 'P')">{{model.ModelName}}</a>
                                                        <span title="In Progress" class="fm-status inprogress"></span>
                                                    </ng-container>
                                                </ng-container>
                                            </div>
                                            <div *ngIf="model.IsCascadeModel"><a
                                                    (click)="navigateToCascadeModels(model)"
                                                    routerLink="/anomaly-detection/problemstatement/cascadeModels/chooseCascadeModels"
                                                    [queryParams]="{ 'cascadedId': model.CorrelationId,'category': model.Category}">
                                                    {{model.ModelName}}</a>
                                            </div>
                                        </td>
                                        <td>{{model.DeployedDate}}</td>
                                        <td>{{model.ModelVersion}}</td>
                                        <td>
                                            <div *ngIf="model.Status == 'Deployed'"> {{model.Accuracy}}%</div>
                                            <div *ngIf="model.Status == 'In Progress'"> NA</div>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="pr-2"> {{model.Status}}</div>
                                                <!-- <ng-container *ngIf="model.Status == 'In Progress'">
                                                    <div class="progress" style="height: 6px; width: 70px;">
                                                        <div class="progress-bar" role="progressbar" aria-valuenow='100'
                                                            aria-valuemin="0" aria-valuemax="100" style="background:rgb(218, 137, 32);
                                                        width: 75%;"></div>
                                                    </div>
                                                </ng-container> -->
                                            </div>
                                        </td>
                                        
                                        <td>
                                            <div class="d-flex align-items-center"
                                                (click)="closeWebSerciveURLWindow(index)">
                                                <ng-container *ngIf="model.Status == 'Deployed'">
                                                    <app-my-visualization [model]="model"
                                                        [parentComponent]="'pstTemplates'">
                                                    </app-my-visualization>
                                                </ng-container>
                                                <div *ngIf="model.Status == 'In Progress'">NA</div>
                                            </div>

                                        </td>
                                        
                                        <td>
                                            <div class="d-flex align-items-center" *ngIf="model.Status == 'Deployed'">
                                                <ng-container
                                                    *ngIf="model.IsPrivate==true && model.IsModelTemplate==false">
                                                    Private
                                                </ng-container>
                                                <ng-container
                                                    *ngIf="model.IsPrivate==false && model.IsModelTemplate==false">
                                                    Public
                                                </ng-container>
                                                <ng-container
                                                    *ngIf="model.IsPrivate==false && model.IsModelTemplate==true">
                                                    Model Template
                                                </ng-container>
                                            </div>
                                            <div *ngIf="model.Status == 'In Progress'"> NA</div>
                                        </td>
                                        <td>
                                            <!-- <a *ngIf="model.IsReadOnlyAccess != true" style="cursor: pointer;"
                                                (click)="deleteModel(model.CorrelationId, model.ModelName)">
                                                <img src="assets/images/delete.svg" />
                                            </a> -->
                                            <a *ngIf="model.IsReadOnlyAccess != true && model.IsIncludedInCascade != true"
                                                style="cursor: pointer;"
                                                (click)="deleteModel(model.CorrelationId, model.ModelName, model.IsCascadeModel)">
                                                <img src="assets/images/delete.svg" />
                                            </a>
                                        </td>
                                    </tr>

                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="d-flex align-items-center justify-content-end myw-pagination mb-0 mt-0">
                        <nav>
                            <ul class="pagination">
                                <li style="margin-top: 1em;">
                                    <pagination-controls id="listing_pagination2" maxSize="8" directionLinks="true"
                                        (pageChange)="page = $event">
                                    </pagination-controls>
                                </li>
                            </ul>
                        </nav>
                        <label class="sr-only">>></label>
                        <div class="position-relative">
                            <label class="sr-only">Page Selection</label>
                            <select #limit (change)="itemsPerPage = limit.value">
                                <option value="10">10/Page</option>
                                <option value="20">20/Page</option>
                                <option value="30">30/Page</option>
                            </select>
                        </div>
                    </div>
                </ng-container>

            </div>
        </div>
        <!-- /content -->
    </div>
    <!-- /wrap -->

</div>

<ng-template #FMInProgressPopup>
    <div class="deploymodle-confirmpopup">
        <div class="modal-header">
            <h5 class="modal-title" id="ingrAI-enter-model-title">Release Success Predictor Model Status</h5>
            <button type="button" class="close" aria-label="Close" (click)="modalRef.hide()"></button>
        </div>
        <div class="modal-body">
            <div class="d-flex flex-column justify-content-center">
                <div>{{this.config.message}}</div>
            </div>
            <div class="d-flex justify-content-end myw-actions" style="margin-top: 1.56rem;">
                <button type="button" class="btn btn-primary" (click)="modalRef.hide()">OK</button>
            </div>
        </div>
    </div>
</ng-template>