<!-- Custom Model-->
<fieldset [disabled]="readOnly">
    <div class="custom-template"
      *ngIf="!displayUploadandDataSourceBlock || (displayUploadandDataSourceBlock==true && isExistingTemplate === false)">
      <div class="myw-section my-3 p-3">
        <div class="row ingrain-template-off">
          <div class="col-12">
            <div class="form-group">
              <label class="txtheading form-label">Problem Statement<span class="myw-required">&nbsp;</span></label>&nbsp;
              <app-info-tooltip class="ml-auto" [description]="'defineproblemhstatement'" [className]="'toggleLeft'"></app-info-tooltip>
              <ng-container *ngIf="!displayUploadandDataSourceBlock">
                <ng-container *ngIf="instaMLModel">
                  <label class="text-area-disabled">{{problemStatement}}</label>
                </ng-container>
                <ng-container *ngIf="!instaMLModel">
                  <textarea class="form-control" maxlength="500" [(ngModel)]=problemStatement [disabled]="instaMLModel"
                    (input)=" changeProblemStatement()" style="height: 2.5rem;">{{problemStatement}}</textarea>
                </ng-container>
                <small class="form-text text-muted">You have {{500 - problemStatement.length}} of 500 characters
                  remaining.</small>
              </ng-container>
              <ng-container *ngIf="displayUploadandDataSourceBlock">
                <ng-container *ngIf="instaMLModel">
                  <label class="text-area-disabled">{{problemStatement}}</label>
                </ng-container>
                <ng-container *ngIf="!instaMLModel">
                  <textarea class="form-control" maxlength="500" [(ngModel)]=problemStatement [disabled]="instaMLModel"
                    rows="3" disabled>{{problemStatement}}</textarea>
                </ng-container>
              </ng-container>
  
            </div>
            <div class="form-group" style="margin-bottom: 0rem;">
              <form  (ngSubmit)="onSubmit()">
                <section id="timeSeriesOptions" *ngIf="isTimeSeriesOn" class="pt-4">
                  <div style=" display: flex; flex-wrap: wrap;">
                    <div class="col-9" style="top: -1em;">
                      <mat-label>Select the Frequency(ies) </mat-label>
                      <div class="form-group mb-2">
                        <mat-accordion>
                          <mat-expansion-panel>
                            <mat-expansion-panel-header>
                                <mat-label *ngIf="objectKeys(timeSeriesCheckboxValues).length == 0">Select the Frequency(ies) </mat-label>
                                <div class="myw-columns-frequency" *ngIf="objectKeys(timeSeriesCheckboxValues).length != 0">
                                  <div *ngFor="let label of objectKeys(timeSeriesCheckboxValues); let i = index"
                                    style="display: inline-flex;">
                                    <label *ngIf="timeSeriesCheckboxValues[label].Steps"
                                      placement="right"
                                      [popover]="timeSeriesCheckboxValues[label].Name +':'+timeSeriesCheckboxValues[label].Steps"
                                      triggers="mouseenter:mouseleave">
                                      <div style=" max-width: 7em;overflow: hidden;text-overflow: ellipsis;">
                                        {{timeSeriesCheckboxValues[label].Name}} : {{timeSeriesCheckboxValues[label].Steps}}
                                      </div>
                                    </label>
                                  </div>
                                </div>
                            </mat-expansion-panel-header>
                           <div style="max-height: 15em; overflow-y: auto;" >
                            <ng-container [ngTemplateOutlet]="ListOfFrequency"></ng-container>
                          </div>   
                        </mat-expansion-panel>
                         </mat-accordion>
                      </div>
                    </div>
                    <div class="col-3">
                      <div class="form-group mb-2">
                        <mat-form-field style="width: -webkit-fill-available;" [formGroup]="timeSeries">
                          <mat-label>Target Aggregation</mat-label>
                          <mat-select [(ngModel)]="targetAggVal" [compareWith]="compareObjects"
                            (ngModelChange)="onTargetAggValSelection()" [disabled]="targetAggDisable"
                            formControlName="targetAggregationControl">
                            <mat-option *ngFor="let aggregation of targetAggregation" [value]="aggregation">
                              {{aggregation}}
                            </mat-option>
                          </mat-select>
                          <mat-error *ngIf="hideTargetValForNone && timeSeries.get('targetAggregationControl').invalid">
                            Please Choose Target Aggregation</mat-error>
                        </mat-form-field>
                      </div>
                    </div>
                  </div>
                </section>
              </form>
              <div class="d-flex align-self-end justify-content-end mb-3">
                <!-- Custom Cascading -->
                <a href="javascript:;" *ngIf="customCascadedId || isFMModel" class="ml-auto mr-3"
                  (click)="showCascadeMapping(cascadeMappingPopup)">
                  <img src="assets/images/cascade.svg" alt="Cascading Icon" />
                </a>
                <!-- Custom Cascading -->
                <!-- Custom Data -->
                <div *ngIf="customApiViewEnabled" class="pr-5">
                  <button class="btn btn-primary" (click)="viewApiResult()">View API Details</button>
                </div>
                <div *ngIf="customQueryViewEnabled" class="pr-5">
                  <button class="btn btn-primary" (click)="viewQueryResult()">View Query Details</button>
                </div>
                <!-- Custom Data -->
                <ng-container *ngIf="readOnly != null" >
                <button *ngIf="!readOnly && !IfModelTemplateDataSource" class="btn btn-primary" (click)="openConfirmationDialog()">Change Data
                  Source</button>
                <button *ngIf="readOnly && !IfModelTemplateDataSource" class="btn btn-primary" (click)="accessDenied()">Change Data Source</button>
              </ng-container>
              <ng-container *ngIf="IfModelTemplateDataSource"> 
                <button class="btn btn-primary" disabled>Change Data Source</button>
              </ng-container>
              <ng-container *ngIf="IfModelTemplateDataSource == false && readOnly == null"> 
                <button class="btn btn-primary" (click)="openConfirmationDialog()">Change Data Source</button>
              </ng-container>
              </div>
              <div class="d-flex align-self-end justify-content-end">
                <span class="dataSource-txt px-3" *ngIf="customApiViewEnabled">Click above to view the API details</span>
                <span class="dataSource-txt px-3" *ngIf="customQueryViewEnabled">Click above to view the Query details</span>
                <span class="dataSource-txt">Click above to change the existing data source</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="myw-section my-3 p-3">
        <div class="row">
          <div class="col-12 col-lg-6 mb-lg-0 mb-3">
            <div id='targetContainer' class="ingrain-section d-flex flex-column h-100">
              <div class="d-flex">
                <div class="myw-500">Attribute To Predict<span class="myw-required">&nbsp;</span></div>
                <app-info-tooltip class="ml-auto" [description]="'attributetopredict'"></app-info-tooltip>
              </div>
              <div class="ingrain-sec-bdy">
                <div *ngIf="targetColButtonDisabled">
                  <div *ngIf='targetColumn' class="ingrain-item">
                    <span class="ingrAI-target-item-name">{{targetColumn}}</span>
                  </div>
                </div>
                <div *ngIf="!targetColButtonDisabled" class="form-group mb-0">
                  <mat-form-field class="w-50" *ngIf="!isCustomAttrClicked">
                    <mat-label>Select</mat-label>
                    <mat-select #targetValue [ngModel]="targetColumn"
                      (ngModelChange)="onSelectChange(targetValue.value,'columnsContainer','targetContainer')">
                      <mat-option *ngIf="!isTimeSeriesOn" [value]="'CustomTarget'">Add Custom Attribute
                        <img src="assets/images/pencil.svg" alt="Add Custom Attribute"
                          style="margin-top: 15px;float: right;" />
                      </mat-option>
                      <mat-option *ngIf="targetColumn" class="target-column" [value]="targetColumn">{{targetColumn}}
                      </mat-option>
                      <ng-container *ngIf="inputColumns">
                        <ng-container *ngIf="inputColumns.size > 0">
                          <mat-option class="input-column" class="input-column" *ngFor="let column of inputColumns"
                            [value]="column">{{column}}
                          </mat-option>
                        </ng-container>
                      </ng-container>
                      <ng-container *ngIf="columnData">
                        <ng-container *ngIf="columnData.size > 0">
                          <mat-option class="columm-data" class="column-data" *ngFor="let column of columnData"
                            [value]="column">{{column}}
                          </mat-option>
                        </ng-container>
                      </ng-container>
                      <ng-container *ngIf="customTargetColumn && showCustomTarget == true">
                        <ng-container
                          *ngIf="customTargetColumn.size > 0 && customTargetColumn.has(targetColumn) !== true">
                          <mat-option class="custom-target" *ngFor="let column of customTargetColumn" [value]="column">
                            {{column}}<span href="javascript:;" title="Remove" class="ml-3"
                              (click)="removeCustomColumn(column)" aria-label="Remove">x</span></mat-option>
                        </ng-container>
                      </ng-container>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="d-flex form-group mb-0" *ngIf="isCustomAttrClicked">
                  <input [(ngModel)]="custTargetName" type="text" maxlength="70" class="form-control w-50">
                  <a href="javascript:;" class="mt-3 ml-3" (click)="isTargetName(custTargetName)">Add</a>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div id='uniqueIdentifierContainer' class="ingrain-section d-flex flex-column h-100">
              <div class="d-flex">
                <div class="myw-500">Unique Identifier<span *ngIf="!isTimeSeriesOn" class="myw-required">&nbsp;</span>
                </div>
                <app-info-tooltip class="ml-auto" [className]="'toggleRight'" [description]="'uniqueidentifier'">
                </app-info-tooltip>
              </div>
  
              <div class="ingrain-sec-bdy">
                <div *ngIf="uniqueIdentifierDisabled">
                  <div *ngIf="uniqueIdentifierVal" class="ingrain-item">
                    <span class="ingrAI-target-item-name">{{uniqueIdentifierVal}}</span>
                  </div>
                </div>
                <div *ngIf="!uniqueIdentifierDisabled" class="form-group mb-0">
                  <mat-form-field class="w-50">
                    <mat-label>Select</mat-label>
                    <mat-select #uniqueValue [(ngModel)]="uniqueIdentifierVal"
                      (ngModelChange)="onSelectChange(uniqueValue.value,'list','uniqueIdentifierContainer')">
                      <mat-option *ngIf="uniqueIdentifierVal" [value]="uniqueIdentifierVal">{{uniqueIdentifierVal}}
                      </mat-option>
                      <ng-container *ngIf="inputColumns">
                        <ng-container *ngIf="inputColumns.size > 0">
                          <ng-container *ngIf="isTimeSeriesOn">
                            <mat-option>None</mat-option>
                          </ng-container>
                          <mat-option *ngFor="let column of inputColumns" [value]="column">{{column}}</mat-option>
                        </ng-container>
                      </ng-container>
                      <ng-container *ngIf="columnData">
                        <ng-container *ngIf="columnData.size > 0">
                          <ng-container *ngIf="isTimeSeriesOn">
                            <mat-option>None</mat-option>
                          </ng-container>
                          <mat-option *ngFor="let column of columnData" [value]="column">{{column}}</mat-option>
                        </ng-container>
                      </ng-container>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="myw-section my-3 p-3">
        <div class="ingrain-section d-flex flex-column">
          <div class="d-flex">
            <div class="myw-500">
              <span *ngIf="!isTimeSeriesOn" class="myw-required">Choose Potential Influencing Attributes</span>
              <span *ngIf="isTimeSeriesOn" class="myw-required">Choose Date Attribute</span>
              <span *ngIf="!isTimeSeriesOn && inputColumns && columnData"
                class="myw-chips ingrain-chips">{{inputColumns.size}}/{{columnData.size+inputColumns.size}}</span>
              <span *ngIf="isTimeSeriesOn && inputColumns && columnData && timeSeriesColumns != ''"
                class="myw-chips ingrain-chips">1/{{columnData.size+inputColumns.size+1}}</span>
              <span *ngIf="isTimeSeriesOn && inputColumns && columnData && timeSeriesColumns == ''"
                class="myw-chips ingrain-chips">0/{{columnData.size+inputColumns.size+1}}</span>
            </div>
            <app-info-tooltip class="ml-auto" [className]="'toggleRight'"
              [description]="'potentialinfluencingattributes'"></app-info-tooltip>
          </div>
          <div class="ingrain-sec-bdy">
            <div class="d-flex flex-wrap myw-columns">
              <label *ngIf="toggleSelect"><input type="checkbox" [disabled]="!showSelectAll" name="select-columns"
                  (click)='selectAll()'><span>Select All</span></label>
              <label *ngIf="!toggleSelect"><input type="checkbox" [disabled]="!showSelectAll" name="select-columns"
                  (click)='deselectAll()'><span>Deselect All</span></label>
              <!-- <ng-container *ngIf="showCustomTarget && !isTimeSeriesOn && customTargetColumn.size > 0">
                <label class="custom-target" *ngFor="let column of customTargetColumn"><input type="checkbox"
                    name="select-columns custom-target-column"><span>{{column}}</span></label>
              </ng-container> -->
              <ng-container *ngIf="isTimeSeriesOn">
                <ng-container *ngIf='timeSeriesColumns'>
                  <label class="timeseries-column"><input type="radio" name="select-columns"
                      (click)="onSelectChange(column,'columnsContainer','timeSeriesColumnsContainer',$event)"
                      checked><span
                      style="background-color: #D9EEFF;border-color: #D9EEFF;font-weight: 500;">{{timeSeriesColumns}}</span></label>
                </ng-container>
                <ng-container *ngFor="let column of columnData">
                  <label *ngIf="column != timeSeriesColumns" class="column-data"><input type="radio" name="select-columns"
                      (click)="onSelectChange(column,'columnsContainer','timeSeriesColumnsContainer',$event)"><span title="{{columnDataTypes[column]}}">{{column}}</span></label>
                </ng-container>
              </ng-container>
              <ng-container *ngIf="!isTimeSeriesOn">
                <label class="input-column" *ngFor="let column of inputColumns">
                  <input type="checkbox"
                    name="select-columns input-column" [disabled]="isModelTrained"
                    (click)="onSelectChange(column,'columnsContainer','columnsContainer', $event)" checked><span title="{{columnDataTypes[column]}}"
                    [ngClass]="(column == proba1Value || column == previousModelTarget) ? 'cursor-default' : ''">{{column}}</span></label>
                <ng-container *ngIf="column != timeSeriesColumns">
                  <label class="column-data" *ngFor="let column of columnData"><input type="checkbox"
                      name="select-columns all-column"  [disabled]="isModelTrained"
                      (click)="onSelectChange(column,'columnsContainer','columnsContainer',$event)"><span title="{{columnDataTypes[column]}}">{{column}}</span></label>
                </ng-container>
                <!-- Custom Cascading -->
                <!--<ng-container *ngIf="mappingData!= null && mappingData != undefined">
                   <label class="cascade-data"><input type="checkbox" disabled
                    name="select-columns cascade-column" checked><span>{{mappingData[0][0].ModelName}}_{{mappingData[0][0].targetColumn}}</span></label>
                  <label class="cascade-data" *ngIf="mappingData[0][0].ProblemType == 'Classification'"><input type="checkbox" disabled
                    name="select-columns cascade-column" checked><span>{{mappingData[0][0].ModelName}}_Prob1</span></label> 
                </ng-container>-->
                <label class="cascade-model-list" *ngIf="!isTimeSeriesOn"><button
                    [disabled]="isIncludedinCustomCascade == true || targetColumn==null || targetColumn=='' || targetColumn==undefined || uniqueIdentifierVal==null || uniqueIdentifierVal=='' || uniqueIdentifierVal==undefined || customCascadedId || isFMModel==true"
                    type="button" class="btn btn-primary" name="select-columns"
                    (click)="getModelsForCascading(customCascadingModels)">List of available models</button></label>
                <!-- Custom Cascading -->
              </ng-container>
            </div>
          </div>
        </div>
      </div>
    </div>
  </fieldset>
  <!-- Custom Model-->
  
  <ng-template #ListOfFrequency>
    <div style="margin-left: 2em">
      <mat-label> Hourly </mat-label>
    </div>
    <mat-form-field style="margin-left: 2em;" [formGroup]="timeSeries">
      <mat-label>Hourly</mat-label>
      <mat-select #hourly id="hourly" formControlName="hourlyControl"
      [(ngModel)]="timeSeriesCheckboxValues[0].Steps"
        [disabled]="instaMLModel">
        <mat-option>None</mat-option>
        <mat-option *ngFor="let hour of hoursList" [value]="hour">{{ hour }}</mat-option>
      </mat-select>
    </mat-form-field>
  
  
    <div style="margin-left: 2em">
      <mat-label> Daily </mat-label>
    </div>
    <mat-form-field style="margin-left: 2em;" [formGroup]="timeSeries">
      <mat-label>Daily</mat-label>
      <mat-select #daily id="daily" formControlName="dailyControl"
      [(ngModel)]="timeSeriesCheckboxValues[1].Steps"
        [disabled]="instaMLModel">
        <mat-option>None </mat-option>
        <mat-option *ngFor="let daily of dailyList" [value]="daily">{{daily}}</mat-option>
      </mat-select>
    </mat-form-field>
  
    <div style="margin-left: 2em">
      <mat-label> Weekly </mat-label>
    </div>
    <mat-form-field style="margin-left: 2em;" [formGroup]="timeSeries">
      <mat-label>Weekly</mat-label>
      <mat-select #weekly id="weekly" formControlName="weeklyControl"
      [(ngModel)]="timeSeriesCheckboxValues[2].Steps"
        [disabled]="instaMLModel">
        <mat-option>None</mat-option>
        <mat-option *ngFor="let weekly of weeklyList" [value]="weekly">{{weekly}}</mat-option>
      </mat-select>
    </mat-form-field>
  
   
    <div style="margin-left: 2em">
      <mat-label> Monthly </mat-label>
    </div>
    <mat-form-field style="margin-left: 2em;" [formGroup]="timeSeries">
      <mat-label>Monthly</mat-label>
      <mat-select #monthly id="monthly" formControlName="monthlyControl"
        [(ngModel)]="timeSeriesCheckboxValues[3].Steps"
        [disabled]="instaMLModel">
        <mat-option>None</mat-option>
        <mat-option *ngFor="let monthly of monthlyList" [value]="monthly">{{monthly}}</mat-option>
      </mat-select>
    </mat-form-field>
  
    <div style="margin-left: 2em">
      <mat-label> Fortnightly
      </mat-label>
    </div>
    <mat-form-field style="margin-left: 2em;" [formGroup]="timeSeries">
      <mat-label>Fortnightly</mat-label>
      <mat-select formControlName="fortNightlyControl"
        [(ngModel)]="timeSeriesCheckboxValues[4].Steps"
        [disabled]="instaMLModel">
        <mat-option>None</mat-option>
        <mat-option *ngFor="let fortNightly of fortnightlyList" [value]="fortNightly">{{fortNightly}}</mat-option>
      </mat-select>
    </mat-form-field>
  
    <div style="margin-left: 2em">
      <mat-label> Quarterly </mat-label>
    </div>
    <mat-form-field style="margin-left: 2em;" [formGroup]="timeSeries">
      <mat-label>Quarterly</mat-label>
      <mat-select formControlName="quarterlyControl"
        [(ngModel)]="timeSeriesCheckboxValues[5].Steps"
        [disabled]="instaMLModel">
        <mat-option>None</mat-option>
        <mat-option *ngFor="let quarterly of quarterlyList" [value]="quarterly">{{quarterly}}</mat-option>
      </mat-select>
    </mat-form-field>
  
    <div style="margin-left: 2em">
      <mat-label> Half-Yearly</mat-label>
    </div>
    <mat-form-field style="margin-left: 2em;" [formGroup]="timeSeries">
      <mat-label>Half-Yearly</mat-label>
      <mat-select formControlName="halfYearlyControl"
        [(ngModel)]="timeSeriesCheckboxValues[6].Steps"
        [disabled]="instaMLModel">
        <mat-option>None</mat-option>
        <mat-option *ngFor="let halfYearly of halfYearlyList" [value]="halfYearly">{{halfYearly}}</mat-option>
      </mat-select>
    </mat-form-field>
  
    <div style="margin-left: 2em">
      <mat-label> Yearly </mat-label>
    </div>
    <mat-form-field style="margin-left: 2em;" [formGroup]="timeSeries">
      <mat-label>Yearly</mat-label>
      <mat-select formControlName="yearlyControl"
        [(ngModel)]="timeSeriesCheckboxValues[7].Steps"
        [disabled]="instaMLModel">
        <mat-option>None</mat-option>
        <mat-option *ngFor="let yearly of yearlyList" [value]="yearly">{{yearly}}</mat-option>
      </mat-select>
    </mat-form-field> 
  
    <div style="margin-left: 2em">
      <mat-label #customDays> Custom Days
      </mat-label>
    </div>
    <div style="display:inline-flex; margin-left: 2em;">
      <mat-form-field class="d-flex" [floatLabel]="'always'" [formGroup]="timeSeries">
        <mat-label>Custom Days</mat-label>
        <input matInput formControlName="customDaysValueControl"
          [(ngModel)]="timeSeriesCheckboxValues[8].value" [disabled]="instaMLModel">
  
      </mat-form-field>
      <mat-form-field class="d-flex ml-3" [floatLabel]="'always'" [formGroup]="timeSeries">
        <mat-label>Frequency</mat-label>
        <mat-select style="padding-left: 5px;" formControlName="customDaysControl"
          [(ngModel)]="timeSeriesCheckboxValues[8].Steps"
          [disabled]="instaMLModel">
          <mat-option>None</mat-option>
          <mat-option *ngFor="let customDays of customDaysList" [value]="customDays">
            {{customDays}}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="timeSeries.controls.customDaysValueControl.status === 'INVALID'">
          Kindly enter value between 1 to 30.
        </mat-error>
  
      </mat-form-field>
    </div>
  </ng-template>